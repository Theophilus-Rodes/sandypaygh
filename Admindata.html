<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Data Packages</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 500px;
      margin: 30px auto;
      background: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .header {
      background: #0a0f5c;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
    }

    .tabs {
      display: flex;
      justify-content: space-around;
      background: #f9f9f9;
      border-bottom: 2px solid #ddd;
    }

    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      font-weight: bold;
      color: #333;
    }

    .tab.active {
      color: white;
      background: #ff9900;
    }

    .content {
      padding: 20px;
      min-height: 200px;
    }

    .package-entry {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .package-entry input {
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
    }

    .submit-btn {
      background: #0a0f5c;
      color: white;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .submit-btn:hover {
      background: #060a42;
    }

    .add-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #0a0f5c;
      color: white;
      border: none;
      padding: 15px 18px;
      font-size: 24px;
      border-radius: 50%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      cursor: pointer;
    }

    .delete-btn {
      background: red;
      color: white;
      border: none;
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">ADD NEW DATA PACKAGES</div>



    
    <div class="tabs">
      <div class="tab active" onclick="switchTab('MTN')">MTN</div>
      <div class="tab" onclick="switchTab('TELECEL')">TELECEL</div>
      <div class="tab" onclick="switchTab('AT')">AT</div>
    </div>
    <div class="content" id="packageList">
      <div class="empty">No packages added yet</div>
    </div>






    <div class="package-entry" id="packageEntry" style="display: none;">
      <input type="text" id="packageName" placeholder="Eg. 5GB">
      <input type="number" id="packageAmount" placeholder="Amount of the data package">
      <button class="submit-btn" onclick="submitPackage()">Continue</button>
    </div>
  </div>

  <button class="add-btn" onclick="toggleEntry()">+</button>

  <script>
    let currentTab = 'MTN';

    function switchTab(network) {
      currentTab = network;
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      loadPackages(network);
    }

    function toggleEntry() {
      const form = document.getElementById('packageEntry');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    async function submitPackage() {
      const name = document.getElementById('packageName').value.trim();
      const amount = document.getElementById('packageAmount').value.trim();

      if (!name || !amount) {
        alert('Please fill both fields.');
        return;
      }

      const payload = {
        network: currentTab,
        data_package: name,
        amount: parseFloat(amount)
      };

      try {
        const res = await fetch('https://sandipay.co/api/admin/add-package', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error('Insert failed');
        loadPackages(currentTab); // Refresh list after insert

        document.getElementById('packageName').value = '';
        document.getElementById('packageAmount').value = '';
        document.getElementById('packageEntry').style.display = 'none';

      } catch (err) {
        console.error(err);
        alert('Something went wrong. Try again.');
      }
    }

    async function deletePackage(id) {
      if (!confirm("Are you sure you want to delete this package?")) return;

      try {
        const res = await fetch("https://sandipay.co/api/delete-admin-package", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id })
        });

        if (!res.ok) throw new Error("Failed to delete");
        loadPackages(currentTab); // Refresh after deletion
      } catch (err) {
        alert("❌ Failed to delete package");
        console.error(err);
      }
    }

    async function loadPackages(network) {
      try {
        const res = await fetch(`https://sandipay.co/api/admin/packages?network=${network}`);
        const data = await res.json();
        const list = document.getElementById("packageList");

        if (!data.length) {
          list.innerHTML = '<div class="empty">No packages added yet</div>';
          return;
        }

        list.innerHTML = data.map(pkg => `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px;">
            <div><strong>${pkg.data_package}</strong> - GHS ${parseFloat(pkg.amount).toFixed(2)}</div>
            <div>
              <select onchange="updateStatus(${pkg.id}, this.value)">
                <option value="active" ${pkg.status === 'active' ? 'selected' : ''}>Active</option>
                <option value="inactive" ${pkg.status === 'inactive' ? 'selected' : ''}>Inactive</option>
              </select>
              <button class="delete-btn" onclick="deletePackage(${pkg.id})">❌</button>
            </div>
          </div>
        `).join('');
      } catch (err) {
        console.error("Load failed", err);
        document.getElementById("packageList").innerHTML = "<div class='empty'>Failed to load packages</div>";
      }
    }

    function updateStatus(id, status) {
      fetch('https://sandipay.co/api/admin/update-status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, status })
      }).then(res => {
        if (!res.ok) alert("Failed to update status");
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadPackages(currentTab);
    });
  </script>
</body>
</html>
